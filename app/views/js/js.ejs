<script>
  const signoutButton = document.getElementById("signout");
  signoutButton.addEventListener("click", () => {
    fetch("/signout", {
      method: "POST",
    }).then(() => {
      window.location.href = "/";
    });
  });

  //get namaalpro.name that starts with FE- from database
  const fearray = [];
  const odcsmt = [];
  const odcjhr = [];
  const odcmjb = [];
  const smtdist = [];
  const jhrdist = [];
  const mjbdist = [];
  const odpsmt = [];
  const odpjhr = [];
  const odpmjb = [];
  fetch("/api/admin/getAllNamaAlpro")
    .then((res) => res.json())
    .then((data) => {
      data.forEach((namaalpro) => {
        if (namaalpro.name.startsWith("FE")) {
          fearray.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("ODC-SMT")) {
          odcsmt.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("ODC-JHR")) {
          odcjhr.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("ODC-MJB")) {
          odcmjb.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("SMT-FB-D")) {
          smtdist.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("JHR-FB-D")) {
          jhrdist.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("MJB-FB-D")) {
          mjbdist.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("ODP-SMT-FB")) {
          odpsmt.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("ODP-JHR-FB")) {
          odpjhr.push(`${namaalpro.name}|${namaalpro.name}`);
        } else if (namaalpro.name.startsWith("ODP-MJB-FB")) {
          odpmjb.push(`${namaalpro.name}|${namaalpro.name}`);
        }
      });
    });

  const dropdown = (s1, s2, s3) => {
    let sel1 = document.getElementById(s1);
    let sel2 = document.getElementById(s2);
    let sel3 = document.getElementById(s3);

    sel3.innerHTML = "";

    if (sel2.value === "Kabel Feeder") {
      var optionArray = fearray;
    } else if (sel1.value === "SMT" && sel2.value === "ODC") {
      var optionArray = odcsmt;
    } else if (sel1.value === "JHR" && sel2.value === "ODC") {
      var optionArray = odcjhr;
    } else if (sel1.value === "MJB" && sel2.value === "ODC") {
      var optionArray = odcmjb;
    } else if (sel1.value === "SMT" && sel2.value === "Kabel/Distribusi") {
      var optionArray = smtdist;
    } else if (sel1.value === "JHR" && sel2.value === "Kabel/Distribusi") {
      var optionArray = jhrdist;
    } else if (sel1.value === "MJB" && sel2.value === "Kabel/Distribusi") {
      var optionArray = mjbdist;
    } else if (sel1.value === "SMT" && sel2.value === "ODP") {
      var optionArray = odpsmt;
    } else if (sel1.value === "JHR" && sel2.value === "ODP") {
      var optionArray = odpjhr;
    } else if (sel1.value === "MJB" && sel2.value === "ODP") {
      var optionArray = odpmjb;
    }

    for (let option in optionArray) {
      let pair = optionArray[option].split("|");
      let newOption = document.createElement("option");

      newOption.value = pair[0];
      newOption.innerHTML = pair[1];
      sel3.options.add(newOption);
    }
  };

  const hiddens = () => {
    let jenisQE = document.getElementById("QE");
    let koordinatBaru = document.getElementById("koordinat");

    if (jenisQE.value != "Normalisasi ODP") {
      koordinatBaru.classList.add("hidden");
    } else {
      koordinatBaru.classList.remove("hidden");
    }
  };

  //ambil data proposal dari database berdasarkan parameter id
  const selected = () => {
    const id = window.location.pathname.split("/")[2];
    // tambahkan selected pada option yang sesuai dengan data yang diambil dari database pada namaSTO, namaAlpro, dan namaQE
    fetch(`/api/admin/proposal/${id}`)
      .then((res) => res.json())
      .then((data) => {
        // set attribute selected pada option yang sesuai dengan data yang diambil dari database
        const sel1 = document.getElementById("sel1");
        const sel2 = document.getElementById("sel2");
        const sel3 = document.getElementById("sel3");
        const sel4 = document.getElementById("QE");
        const sel5 = document.getElementById("koordinatODPBaru");
        const sel6 = document.getElementById("keterangan");

        //set attribute selected pada option yang sesuai dengan data yang diambil dari database
        sel1.value = data.namaSTO;
        sel2.value = data.segmen;
        sel3.value = data.namaAlpro;
        sel4.value = data.jenisQE;
        sel5.value = data.koordinatODPBaru;
        sel6.value = data.keterangan;
      });
  };
</script>
